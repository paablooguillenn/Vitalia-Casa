services:
  postgres:
    image: postgres:15
    container_name: citas-postgres 
    environment:
      POSTGRES_DB: citasmedicas
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: 123456
    ports:
      - "5433:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql  # ‚Üê PARA EJECUTAR init.sql
    healthcheck:  
      test: ["CMD-SHELL", "pg_isready -U postgres -d citasmedicas -h 10.48.222.3"]
      interval: 10s
      timeout: 5s
      retries: 30
      start_period: 40s

  api:
    build: 
      context: .  
      dockerfile: Dockerfile  
    image: citas-medicas-api  
    container_name: citas-api  
    ports:
      - "8080:8080"
    environment:
      JWT_SECRET: "miClaveJwtSuperSeguraMuyLargaConAlMenos64CaracteresPara256BitsHS256CitasMedicas2026XyzAbc123Def456Ghi789Jkl012Mno345Pqr678Stu901Vwx234Yza567Bcd890Efg123Hij456KlM789NoP012QrS345TuV678WxY901ZaB234Cde567Fgh890Ijk123Lmn456Opq789Rst012Uvw345Xyz678Abc901Def234Ghi567Jkl890Mno123Pqr456Stu789Vwx012Yza345Bcd678Efg901Hij234KlM567Nop890QrS123Tuv456Wxy789Zab012Cde345Fgh678Ijk901Lmn234Opq567Rst890Uvw123Xyz456Abc789Def012Ghi345Jkl678Mno901Pqr234Stu567Vwx890Yza123Bcd456Efg789Hij012KlM345Nop678QrS901Tuv234Wxy567Zab890Cde123Fgh456Ijk789Lmn012Opq345Rst678Uvw901Xyz234Abc567Def890Ghi123Jkl456Mno789Pqr012Stu345Vwx678Yza901Bcd234Efg567Hij890KlM123Nop456QrS789Tuv012Wxy345Zab678Cde901Fgh234Ijk567Lmn890Opq123Rst456Uvw789Xyz012Abc345Def678Ghi901Jkl234Mno567Pqr890Stu123Vwx456Yza789Bcd012Efg345Hij678KlM901Nop234QrS567Tuv890Wxy123Zab456Cde789Fgh012Ijk345Lmn678Opq901Rst234Uvw567Xyz890Abc123Def456Ghi789"
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/citasmedicas
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: "123456"
      SPRING_DATASOURCE_DRIVER_CLASS_NAME: org.postgresql.Driver
      SPRING_JPA_DATABASE_PLATFORM: org.hibernate.dialect.PostgreSQLDialect
      SPRING_PROFILES_ACTIVE: prod
      SPRING_DATASOURCE_HIKARI_CONNECTION_TIMEOUT: 120000
      SPRING_DATASOURCE_HIKARI_MAXIMUM_POOL_SIZE: 10
      SPRING_DATASOURCE_HIKARI_IDLE_TIMEOUT: 600000
      SPRING_JPA_HIBERNATE_DDL_AUTO: update
    volumes:
      - ./profile_pictures:/app/profile_pictures
  frontend:
    build:
      context: ./frontend/medical-appointment-manager
      dockerfile: Dockerfile
    image: citas-frontend
    container_name: citas-frontend
    ports:
      - "3000:3000"
    environment:
      NODE_ENV: production
    depends_on:
      - api
    volumes:
      - ./profile_pictures:/app/profile_pictures

volumes:
  postgres_data: {}
